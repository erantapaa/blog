<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Projection matrix</title>
  <meta name="description" content="Layout run failed ._.
">

  <!-- syntax highlighter -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://maurizzzio.github.io//static/computer-graphics/opengl/projection-matrix.html">
  <link rel="alternate" type="application/rss+xml" title="Mauricio Poppe" href="http://maurizzzio.github.io//feed.xml" />

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Mauricio Poppe</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

<!--       <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/binary-exponentiation.html">Binary Exponentiation</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/chinese-remainder-theorem.html">Chinese Remainder Theorem</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/combining-transformations.html">Combining transformations</a>
          
        
          
          <a class="page-link" href="/static/math/numeral-systems/complex-numbers.html">Complex numbers</a>
          
        
          
          <a class="page-link" href="/static/graphs/components.html">Components</a>
          
        
          
          <a class="page-link" href="/static/graphs/cut-edges.html">Cut-edges (bridges)</a>
          
        
          
          <a class="page-link" href="/static/graphs/cut-vertices.html">Cut-vertices (articulation points)</a>
          
        
          
          <a class="page-link" href="/static/math/calculus/derivative.html">Derivative</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/discrete-logarithm.html">Discrete Logarithm</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/divisor-function.html">Divisor Function</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/erathostenes-sieve.html">Erathostenes Sieve</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/euclidean-algorithm.html">Euclidean Algorithm</a>
          
        
          
          <a class="page-link" href="/static/graphs/special/eulerian-graphs.html">Eulerian Graph</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/eulers-phi.html">Euler's phi function</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/extended-euclidean-algorithm.html">Extended Euclidean Algorithm</a>
          
        
          
        
          
          <a class="page-link" href="/static/graphs/special/hamiltonian_graphs.html">Hamiltonian Graphs</a>
          
        
          
        
          
          <a class="page-link" href="/static/graphs/tree/">Tree</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/integer-factorization.html">Integer Factorization</a>
          
        
          
          <a class="page-link" href="/static/math/calculus/integral.html">Integral</a>
          
        
          
          <a class="page-link" href="/static/graphs/introduction.html">Introduction</a>
          
        
          
          <a class="page-link" href="/static/math/calculus/introduction.html">Introduction</a>
          
        
          
        
          
          <a class="page-link" href="/static/math/number-theory/modular-arithmetic.html">Modular Arithmetic</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/orthographic-projection.html">Orthographic projection</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/perspective-projection.html">Perspective projection</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/primality-test.html">Primality Test</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/prime-factors-factorial.html">Prime factors of a factorial</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/opengl/projection-matrix.html">Projection matrix</a>
          
        
          
          <a class="page-link" href="/static/math/geometry/projective-geometry.html">Projective Geometry</a>
          
        
          
          <a class="page-link" href="/static/math/numeral-systems/quaternions.html">Quaternions</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/rotation/quaternions.html">Quaternions</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/fundamentals/ray-tracing.html">Ray tracing</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/fundamentals/rendering.html">Rendering</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/resources.html">Resources</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/rotation.html">Rotations</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/scale.html">Scale</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/shearing.html">Shearing</a>
          
        
          
          <a class="page-link" href="/static/graphs/single-source-shortest-path.html">Single Source Shortest Path (SSSP)</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/space-coordinates.html">Space coordinates</a>
          
        
          
          <a class="page-link" href="/static/graphs/tree/spanning-tree.html">Spanning Tree</a>
          
        
          
          <a class="page-link" href="/static/math/number-theory/special-factorial-modulo-m.html">Special factorial modulo p</a>
          
        
          
          <a class="page-link" href="/static/math/calculus/taylor-theorem-infinite-series.html">Taylor's Theorem and Infinite Series</a>
          
        
          
          <a class="page-link" href="/static/graphs/topological-sorting.html">Topological sorting</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/math/translation.html">Translation</a>
          
        
          
          <a class="page-link" href="/static/graphs/traversal.html">Traversal</a>
          
        
          
          <a class="page-link" href="/static/computer-graphics/opengl/view-matrix.html">View matrix</a>
          
        
      </div>
 -->
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="static-page-sidebar">
        <ul><li><li><ul><li>static<ul><li>computer-graphics<ul><li><a href="/static/computer-graphics/resources.html">Resources</a></li><li>fundamentals<ul><li><a href="/static/computer-graphics/fundamentals/rendering.html">Rendering</a></li><li><a href="/static/computer-graphics/fundamentals/ray-tracing.html">Ray tracing</a></li></ul></li><li>math<ul><li><a href="/static/computer-graphics/math/space-coordinates.html">Space coordinates</a></li><li><a href="/static/computer-graphics/math/scale.html">Scale</a></li><li><a href="/static/computer-graphics/math/shearing.html">Shearing</a></li><li><a href="/static/computer-graphics/math/rotation.html">Rotations</a></li><li><a href="/static/computer-graphics/math/translation.html">Translation</a></li><li><a href="/static/computer-graphics/math/orthographic-projection.html">Orthographic projection</a></li><li><a href="/static/computer-graphics/math/perspective-projection.html">Perspective projection</a></li><li><a href="/static/computer-graphics/math/combining-transformations.html">Combining transformations</a></li><li>rotation<ul><li><a href="/static/computer-graphics/math/rotation/quaternions.html">Quaternions</a></li></ul></li></ul></li><li>opengl<ul><li><a href="/static/computer-graphics/opengl/view-matrix.html">View matrix</a></li><li><a href="/static/computer-graphics/opengl/projection-matrix.html">Projection matrix</a></li></ul></li></ul></li><li>graphs<ul><li><a href="/static/graphs/introduction.html">Introduction</a></li><li><a href="/static/graphs/traversal.html">Traversal</a></li><li><a href="/static/graphs/topological-sorting.html">Topological sorting</a></li><li><a href="/static/graphs/cut-edges.html">Cut-edges (bridges)</a></li><li><a href="/static/graphs/cut-vertices.html">Cut-vertices (articulation points)</a></li><li><a href="/static/graphs/components.html">Components</a></li><li><a href="/static/graphs/single-source-shortest-path.html">Single Source Shortest Path (SSSP)</a></li><li>special<ul><li><a href="/static/graphs/special/eulerian-graphs.html">Eulerian Graph</a></li><li><a href="/static/graphs/special/hamiltonian_graphs.html">Hamiltonian Graphs</a></li></ul></li><li>tree<ul><li><a href="/static/graphs/tree/spanning-tree.html">Spanning Tree</a></li></ul></li></ul></li><li>math<ul><li>calculus<ul><li><a href="/static/math/calculus/introduction.html">Introduction</a></li><li><a href="/static/math/calculus/derivative.html">Derivative</a></li><li><a href="/static/math/calculus/integral.html">Integral</a></li><li><a href="/static/math/calculus/taylor-theorem-infinite-series.html">Taylor's Theorem and Infinite Series</a></li></ul></li><li>geometry<ul><li><a href="/static/math/geometry/projective-geometry.html">Projective Geometry</a></li></ul></li><li>number-theory<ul><li><a href="/static/math/number-theory/eulers-phi.html">Euler's phi function</a></li><li><a href="/static/math/number-theory/binary-exponentiation.html">Binary Exponentiation</a></li><li><a href="/static/math/number-theory/erathostenes-sieve.html">Erathostenes Sieve</a></li><li><a href="/static/math/number-theory/euclidean-algorithm.html">Euclidean Algorithm</a></li><li><a href="/static/math/number-theory/extended-euclidean-algorithm.html">Extended Euclidean Algorithm</a></li><li><a href="/static/math/number-theory/modular-arithmetic.html">Modular Arithmetic</a></li><li><a href="/static/math/number-theory/chinese-remainder-theorem.html">Chinese Remainder Theorem</a></li><li><a href="/static/math/number-theory/discrete-logarithm.html">Discrete Logarithm</a></li><li><a href="/static/math/number-theory/special-factorial-modulo-m.html">Special factorial modulo p</a></li><li><a href="/static/math/number-theory/prime-factors-factorial.html">Prime factors of a factorial</a></li><li><a href="/static/math/number-theory/primality-test.html">Primality Test</a></li><li><a href="/static/math/number-theory/divisor-function.html">Divisor Function</a></li><li><a href="/static/math/number-theory/integer-factorization.html">Integer Factorization</a></li></ul></li><li>numeral-systems<ul><li><a href="/static/math/numeral-systems/complex-numbers.html">Complex numbers</a></li><li><a href="/static/math/numeral-systems/quaternions.html">Quaternions</a></li></ul></li></ul></li></ul></li></ul></li></li></ul>
      </div>

      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Projection matrix</h1>
  </header>

  <article class="post-content">
    <ul id="markdown-toc">
  <li><a href="#perspective-projection" id="markdown-toc-perspective-projection">Perspective projection</a>    <ul>
      <li><a href="#general-perspective-projection-matrix" id="markdown-toc-general-perspective-projection-matrix">General perspective projection matrix</a></li>
      <li><a href="#symmetric-perspective-projection-matrix" id="markdown-toc-symmetric-perspective-projection-matrix">Symmetric perspective projection matrix</a></li>
      <li><a href="#symmetric-perspective-projection-matrix-from-field-of-viewaspect" id="markdown-toc-symmetric-perspective-projection-matrix-from-field-of-viewaspect">Symmetric perspective projection matrix from field of view/aspect</a></li>
    </ul>
  </li>
  <li><a href="#orthographic-projection" id="markdown-toc-orthographic-projection">Orthographic projection</a></li>
</ul>

<p>A 3D scene must be projected onto the computer 2D screen, there are two commonly projection methods</p>

<ul>
  <li><em>orthographic</em> or parallel projection where the <em>view volume</em> which is normally a rectangular box is transformed into a unit cube</li>
  <li><em>perspective</em> projection where the <em>view volume</em> is normally a truncated pyramid is transformed into a unit cube, in this projection the farther away an object is from the point of view the smaller appears after projection</li>
</ul>

<p>In both projection a series of transformations occur</p>

<ul>
  <li>eye/camera coordinates are transformed to clip coordinates</li>
  <li>clip coordinates are transformed to normalized device coordinates (NDC transformation), a cube with its extreme points at $(-1, -1, -1)$ and $(1, 1, 1)$ called the <em>canonical view volume</em></li>
</ul>

<h2 id="perspective-projection">Perspective projection</h2>

<p>Projective geometry concepts are used in this type of projection, particularly the fact that objects away from the point of view appear smaller after projection, this type of projection mimics how we perceive objects in reality</p>

<p>A perspective projection matrix is built with 6 parameters, <em>left, right, bottom, top, near, far</em></p>

<ul>
  <li><em>near</em>: plane in the $z$-axis where the 3D scene is projected into</li>
  <li><em>left, right</em>: view volume $x$-bounds defined in the <em>near</em> plane</li>
  <li><em>bottom, right</em>: view volume $y$-bounds defined in the <em>near</em> plane</li>
  <li><em>far</em>: plane in the $z$-axis which defines a far bound during the rendering process, only objects that are visible between the <em>near</em> plane and the <em>far</em> plane will be rendered</li>
</ul>

<h3 id="general-perspective-projection-matrix">General perspective projection matrix</h3>

<p><img src="/images/projection-matrix!perspective-all.png" alt="perspective projection" class="center-image" /></p>

<p>The coordinates of a point projected onto the <em>near</em> plane are computed trivially</p>

<p>Let $(x_e, y_e, z_e)$ be the coordinates of a point in eye space which is going to be projected to $(x_p, y_p, z_p)$ on the <em>near</em> plane</p>

<p><img src="/images/projection-matrix!top-view-frustum.png" alt="top view of the frustum" /> <img src="/images/projection-matrix!side-view-frustum.png" alt="side view of the frustum" /></p>

<p>By similar triangles we see that the value of $x_p$ and $y_p$ is</p>

<script type="math/tex; mode=display">\frac{x_p}{x_e} = \frac{-n}{z_e} \quad \quad x_p = \frac{n \cdot x_e}{-z_e} \\
\frac{y_p}{y_e} = \frac{-n}{z_e} \quad \quad y_p = \frac{n \cdot y_e}{-z_e}</script>

<p>The value of $z_e$ is equal to $-n$</p>

<p>Notice that both quantities are inversely proportional to $-z_e$, what we can do is manipulate the coordinate so that it has a common denominator</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{bmatrix} \tfrac{n \cdot x_e}{-z_e} & \tfrac{n \cdot y_e}{-z_e} & n \tfrac{z_e}{-z_e} \end{bmatrix}^T = \frac{  \begin{bmatrix} n \cdot x_e & n \cdot y_e & n \cdot z_e \end{bmatrix}^T }{-z_e} %]]></script>

<p>The point above can be expressed with the following homogeneous coordinate</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{bmatrix} n \cdot x_e & n \cdot y_e & n \cdot z_e& \tfrac{1}{-z_e}  \end{bmatrix}^T %]]></script>

<p>OpenGL will then project any 4D homogeneous coordinate to the 3D hyperplane $w=1$ by dividing each of the coordinates by $w$, note that this division operation isn’t done by the application but by OpenGL itself on a further step on the rendering pipeline</p>

<p>We can take advantage of this process and use $-z_e$ as our $w$, with this in mind we can construct a transformation matrix so that transformed points have $w = -z_e$</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{pm1}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
. & . & . & . \\
. & . & . & . \\
. & . & . & . \\
0 & 0 & -1 & 0
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}  \quad \therefore w_c = -z_e
\end{equation} %]]></script>

<p>Where $x_c, y_c, z_c, w_c$ are expressed in clipping coordinates, when each coordinate is divided by $w_c$ we’ll have NDC i.e.</p>

<script type="math/tex; mode=display">\begin{bmatrix} x_{NDC} \\ y_{NDC} \\ z_{NDC} \end{bmatrix} = \begin{bmatrix} x_c/w_c \\ y_c/w_c \\ z_c/w_c \end{bmatrix}</script>

<p>Next $x_p$ and $y_p$ are mapped linearly to $[-1,1]$, i.e. $[left, right] \Rightarrow [-1, 1]$ and $[bottom, top] \Rightarrow [-1, 1]$</p>

<p>A function is needed such that $f(left) = -1$ and $f(right) = 1$, since we know that the values are mapped linearly the function has the form $f(x) = a + bx$, next we can simplify the problem by making the function $f(x) = a + c \cdot g(x)$ where $g(x)$ is a function such that $g(left) = 0$ and $g(right) = 1$, then the function $g(x)$ can be computed trivially as</p>

<script type="math/tex; mode=display">g(x) = \frac{x - l}{r - l}</script>

<p>If $g(x)$ is in the range $[0, 1]$ then $f(x)$ is simplified to $f(x) = -1 + 2 \cdot g(x)$, substituting $g(x)$ in $f(x)$ and</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
f(x) &= -1 + 2 \frac{x - l}{r - l} \nonumber \\
&= \frac{l - r}{r - l} + 2 \frac{x - l}{r - l} \nonumber \\
&= \frac{2x - l - r}{r - l} \nonumber \\
&= \frac{2x}{r - l} - \frac{r + l}{r - l} \label{linear-map}
\end{align} %]]></script>

<p>If we let $x_{NDC} = f(x)$ then</p>

<script type="math/tex; mode=display">x_{NDC} = \frac{2x_p}{r - l} - \frac{r + l}{r - l}</script>

<p>Similarly $y_{NDC}$ is</p>

<script type="math/tex; mode=display">y_{NDC} = \frac{2y_p}{t - b} - \frac{t + b}{t - b}</script>

<p>Next we substitute the value of $x_p$ in $x_{NDC}$</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
x_{NDC} &= \frac{2 \cdot \frac{n \cdot x_e}{-z_e}}{r - l} - \frac{r + l}{r - l} \\
&= \frac{2 \cdot n \cdot x_e}{(r - l)(-z_e)} - \frac{r + l}{r - l} \\
&= \frac{2 \cdot n \cdot x_e}{(r - l)(-z_e)} - \frac{r + l}{r - l} \frac{z_e}{z_e} \\
&= \left (  \frac{2 \cdot n}{r - l} x_e + \frac{r + l}{r - l} z_e \right ) \big / -z_e
\end{align*} %]]></script>

<p>Note that the second fraction is manipulated so that it’s divisible by $-z_e$ (the term used to transform the point to NDC), also note that the quantity in the parenthesis (namely $x_c$) is in clipping coordinates</p>

<script type="math/tex; mode=display">x_c = \frac{2n}{r - l} x_e + \frac{r + l}{r - l} z_e</script>

<p>Similarly the value of $y_c$ is</p>

<script type="math/tex; mode=display">y_c = \frac{2n}{t - b} y_e + \frac{t + b}{t - b} z_e</script>

<p>Then the transformation matrix seen in \eqref{pm1} is now</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{pm2}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
\tfrac{2n}{r - l} & 0 & \tfrac{r + l}{r - l} & 0 \\
0 & \tfrac{2n}{t - b} & \tfrac{t + b}{t - b} & 0 \\
. & . & . & . \\
0 & 0 & -1 & 0
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}
\end{equation} %]]></script>

<p>Next we need to find the value of $z_c$, note that the value is always $-n$ so we could make $z_{NDC} = \tfrac{-n \cdot z_e}{z_e}$ but we need <strong>$z_c$ to be unique for the clipping and depth test</strong>, plus we should be able to unproject it (through an inverse transformation)</p>

<p>Since $z_{NDC}$ doesn’t depend on $x_e$ or $y_e$ we can borrow the $w$-coordinate to find the relationship between $z_{NDC}$ and $z_e$, with that in mind we can make the third row of \eqref{pm2} equal to</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{pm3}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
\tfrac{2n}{r - l} & 0 & \tfrac{r + l}{r - l} & 0 \\
0 & \tfrac{2n}{t - b} & \tfrac{t + b}{t - b} & 0 \\
0 & 0 & A & B \\
0 & 0 & -1 & 0
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}
\end{equation} %]]></script>

<p>Then $z_{NDC}$ has the form</p>

<script type="math/tex; mode=display">z_{NDC} = \frac{z_c}{w_c} = \frac{Az_e + Bw_e}{-z_e}</script>

<p>Since $w_e=1$ in eye space</p>

<script type="math/tex; mode=display">z_{NDC} = \frac{Az_e + B}{-z_e}</script>

<p>Note that the value is not linear but it needs to be mapped to $[-near, -far] \Rightarrow [-1,1]$, substituting the range ends in $z_{NDC}$ we have a system of equations</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{cases}
-1 &= \frac{-An + B}{n} \\
1 &= \frac{-Af + B}{f}
\end{cases} \rightarrow 
\begin{cases}
-An + B &= -n \\
-Af + B &= f
\end{cases} %]]></script>

<p>Subtracting the second equation from the first</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
-An + B + Af - B &= -n - f \\
A (f - n) &= -n - f \\
A = -\frac{f + n}{f - n}
\end{align*} %]]></script>

<p>Solving for $B$ given $A$</p>

<script type="math/tex; mode=display">\frac{f + n}{f - n}n + B = -n</script>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
B &= -n - \frac{f + n}{f - n}n \\
&= \frac{-fn + n^2 - fn - n^2}{f - n} \\
&= \frac{-2fn}{f - n} \\
\end{align*} %]]></script>

<p>Substituting the values of $A$ and $B$ in \eqref{pm3} we have the <strong>general perspective projection matrix</strong></p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{pm4}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
\tfrac{2n}{r - l} & 0 & \tfrac{r + l}{r - l} & 0 \\
0 & \tfrac{2n}{t - b} & \tfrac{t + b}{t - b} & 0 \\
0 & 0 & -\tfrac{f + n}{f - n} & \tfrac{-2fn}{f - n} \\
0 & 0 & -1 & 0
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}
\end{equation} %]]></script>

<h3 id="symmetric-perspective-projection-matrix">Symmetric perspective projection matrix</h3>

<p>If the viewing volume is symmetric i.e. $r = -l$ and $t = -b$ then some quantities can be simplified</p>

<script type="math/tex; mode=display">r + l = 0, \quad r - l = 2r \\
t + b = 0, \quad t - b = 2t</script>

<p>Then \eqref{pm4} becomes</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{pm5}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
\tfrac{n}{r} & 0 & 0 & 0 \\
0 & \tfrac{n}{t} & 0 & 0 \\
0 & 0 & -\tfrac{f + n}{f - n} & \tfrac{-2fn}{f - n} \\
0 & 0 & -1 & 0
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}
\end{equation} %]]></script>

<h3 id="symmetric-perspective-projection-matrix-from-field-of-viewaspect">Symmetric perspective projection matrix from field of view/aspect</h3>

<p><a href="https://www.opengl.org/sdk/docs/man2/xhtml/gluPerspective.xml"> <code class="highlighter-rouge">gluPerspective</code> </a> receives instead of the $x$ and $y$ bounds two arguments</p>

<ul>
  <li><em>field of view</em> ($fov$) which specifies the field of view angle in the $y$ direction</li>
  <li><em>aspect</em> ($aspect$) which is the aspect ratio that determines the field of view in the $x$ direction calculated as $\tfrac{x}{y}$, the value is commonly $\tfrac{screen \; width}{screen \; height}$</li>
</ul>

<p><img src="/images/projection-matrix!fov.png" alt="fov" class="center-image" /></p>

<p>We see that the value of $t$ (top) is</p>

<script type="math/tex; mode=display">\begin{equation} \label{fov-t}
\tan{ (fov/2) } = \frac{t}{n} \\
t = n \cdot \tan{ (fov/2) }
\end{equation}</script>

<p>We can find the value of $r$ (right) with the aspect ratio</p>

<script type="math/tex; mode=display">\begin{equation} \label{fov-r}
aspect = \frac{2r}{2t} = \frac{r}{t} \\
r = aspect \cdot t = aspect \cdot n \cdot \tan{(fov/2)}
\end{equation}</script>

<p>Substituting \eqref{fov-t} and \eqref{fov-r} in \eqref{pm5}</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{pm6}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
\tfrac{1}{aspect \cdot \tan{ (fov/2) } } & 0 & 0 & 0 \\
0 & \frac{1}{\tan{ (fov/2) }} & 0 & 0 \\
0 & 0 & -\tfrac{f + n}{f - n} & \tfrac{-2fn}{f - n} \\
0 & 0 & -1 & 0
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}
\end{equation} %]]></script>

<h2 id="orthographic-projection">Orthographic projection</h2>

<p>Constructing an orthographic projection matrix is simpler compared to the perspective projection one, all coordinates that belong to the view volume in <em>eye space</em> are directly mapped to NDC using the same linear relationship</p>

<p><img src="http://www.songho.ca/opengl/files/gl_projectionmatrix02.png" alt="orthographic projection" class="center-image" /></p>

<p>We can use \eqref{linear-map} as the starting point noticing that when a point is projected to the plane $z=-near$ it’ll keep it’s $x$ and $y$ coordinates therefore</p>

<script type="math/tex; mode=display">x_c = \frac{2}{r - l}x_e - \frac{r + l}{r - l}</script>

<script type="math/tex; mode=display">y_c = \frac{2}{t - b}y_e - \frac{t + b}{t - b}</script>

<p>The $z_c$ value will be different from the ones above since we’re mapping $[-near, -far] \Rightarrow [-1, 1]$</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
z_c &= \frac{2}{-f - (-n)}z_e - \frac{-f + (-n)}{-f - (-n)} \\
&= \frac{2}{-f + n}z_e - \frac{-f - n}{-f + n} \\
&= -\frac{2}{f - n}z_e + \frac{-f - n}{f - n} \\
&= -\frac{2}{f - n}z_e - \frac{f + n}{f - n}
\end{align*} %]]></script>

<p>The $w$ component is not needed since the projection to the $z=-near$ plane doesn’t needed a division operation, the <strong>general orthographic projection matrix</strong> is</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation} \label{om1}
\begin{bmatrix} x_c \\ y_c \\ z_c \\ w_c \end{bmatrix} = \begin{bmatrix}
\tfrac{2}{r - l} & 0 & 0 & -\tfrac{r + l}{r - l} \\
0 & \tfrac{2}{t - b} & 0 & -\tfrac{t + b}{t - b} \\ 
0 & 0 & -\tfrac{2}{f - n} & -\tfrac{f + n}{f - n} \\
0 & 0 & 0 & 1
\end{bmatrix} \begin{bmatrix} x_e \\ y_e \\ z_e \\ w_e \end{bmatrix}
\end{equation} %]]></script>

<p>Finally note that $w_c$ will always have the value of $w_e = 1$, therefore the transformation to NDC will not modify the coordinates</p>

<script type="math/tex; mode=display">\begin{bmatrix} x_{NDC} \\ y_{NDC} \\ z_{NDC} \end{bmatrix} = \begin{bmatrix}
x_c/1 \\
y_c/1 \\ 
z_c/1 
\end{bmatrix}</script>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <!-- <h2 class="footer-heading">Mauricio Poppe</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Mauricio Poppe</li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/maurizzzio">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">maurizzzio</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/iMauricio">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">iMauricio</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Layout run failed ._.
</p>
      </div>
    </div>

  </div>

  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    showProcessingMessages: false,
    messageStyle: 'none',
    tex2jax: {
      // http://docs.mathjax.org/en/latest/options/tex2jax.html
      inlineMath: [['$','$']],
      displayMath: [['$$','$$']]
      // processEnvironments: false
    },
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      },
      Macros: {
        edge: '\\mathrel{-}',
        notedge: '\\not\\edge',
        deg: ['#1^{\\circ}', 1],
        tbold: ['\\textbf{#1}', 1],
        mbold: ['\\mathbf{#1}', 1],
        unit: ['\\widehat{\\mathbf{#1}}', 1],

        magnitude: ['\\left \\| #1 \\right \\|', 1],
        norm: ['\\left \\| #1 \\right \\|', 1]
      }
    },
    'HTML-CSS': {
      imageFont: null
    }
  });
</script>

<script type="text/javascript">
/*
 * MathJax eqn preview for a tags
 *
 * Copyright (c) 2015 Mauricio Poppe
 * Licensed under the MIT license.
 */

(function () {
  var $container = $('.post-content');
  var $tooltip = $('<div />').addClass('mathjax-tooltip');
  $container.append($tooltip);

  function onMouseOver(ev) {
    var a = ev.currentTarget;
    var $number = $(a.hash);
    var $root = $number.closest('.MathJax_Display');
    var bounds = $(a).offset();
    var containerBounds = $container.offset();

    $tooltip.stop(true, true);
    $tooltip.empty();
    $tooltip.append($root.clone());
    $tooltip.css({
      top: bounds.top - containerBounds.top - $tooltip.height() - 5,
      left: -1
    });
    $tooltip.addClass('active');
  }

  function onMouseOut(a) {
    $tooltip.removeClass('active');
  }

  MathJax.Hub.Queue(function () {
    $container.on('mouseover', 'a[href*="mjx-eqn-"]', onMouseOver);
    $container.on('mouseout', 'a[href*="mjx-eqn-"]', onMouseOut);
  });

})();
</script>

</footer>


  </body>

</html>
