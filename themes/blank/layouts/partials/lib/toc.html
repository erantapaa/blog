<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/3.0.2/tocbot.min.js"></script>
<script>
(function () {
  var toc = document.querySelector('nav[role=navigation]')
  var hero = document.querySelector('section.hero')
  var tocWrapper = document.querySelector('.toc-wrapper')

  if (!toc || !hero) return;

  tocbot.init({
    tocSelector: '#toc',
    contentSelector: 'article[role=main]',
    headingSelector: 'h1,h2,h3,h4,h5,h6',
    collapseDepth: 6
  })

  var position = ''
  var rect = hero.getBoundingClientRect()
  var heroBot = rect.bottom + window.scrollY
  window.addEventListener('scroll', function () {
    var newPosition = ''
    if (window.scrollY > heroBot) {
      newPosition = 'fixed'
    }
    if (newPosition !== position) {
      var wrapperWidth = tocWrapper.getBoundingClientRect().width
      if (newPosition === 'fixed') {
        // 80: breadcrumb
        // 48: content padding top
        toc.style.top = (80 + 48) + 'px'
        toc.style.width = wrapperWidth + 'px'
      } else {
        toc.style.width = 'auto'
        toc.style.top = ''
      }
      toc.style.position = newPosition
      position = newPosition
    }
  })
})()
</script>

